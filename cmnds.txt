Flow of creating project :
-> VPC
-> Subnet
-> Reserve static-ip address
-> Firewall rule
-> Instance template
-> Health-check
-> Managed Instance group
-> Load Balancer






VPC creation : gcloud compute networks create hardik-vpc --project=playground-s-11-99902a3b --subnet-mode=custom --mtu=1460 --bgp-routing-mode=global

Subnet creation : gcloud compute networks subnets create subnet-us-central1 --project=playground-s-11-99902a3b --range=10.128.0.0/20 --stack-type=IPV4_ONLY --network=hardik-vpc --region=us-central1

Static ip reservation : gcloud compute addresses create hardik-static-ip --project=playground-s-11-99902a3b --global

tag : allow-health-checks

firewall rule : gcloud compute --project=playground-s-11-99902a3b firewall-rules create rule-1 --direction=INGRESS --priority=1000 --network=hardik-vpc --action=ALLOW --rules=tcp:22,tcp:5000 --source-ranges=0.0.0.0/0

instance template : gcloud compute instance-templates create hardik-instance-template --project=playground-s-11-99902a3b --machine-type=n1-standard-1 --network-interface=network-tier=PREMIUM,subnet=subnet-us-central1 --metadata=startup-script=sudo\ apt\ update$'\n'sudo\ apt\ install\ python3-pip\ -y$'\n'sudo\ apt-get\ -y\ install\ git$'\n'git\ clone\ https://github.com/hardikgandhi03/flask-demo$'\n'pip\ install\ flask$'\n'sudo\ pip\ install\ firebase-admin$'\n'cd\ flask-demo$'\n'python3\ main.py --maintenance-policy=MIGRATE --provisioning-model=STANDARD --service-account=615923458301-compute@developer.gserviceaccount.com --scopes=https://www.googleapis.com/auth/devstorage.read_only,https://www.googleapis.com/auth/logging.write,https://www.googleapis.com/auth/monitoring.write,https://www.googleapis.com/auth/servicecontrol,https://www.googleapis.com/auth/service.management.readonly,https://www.googleapis.com/auth/trace.append --region=us-central1 --tags=allow-health-checks,http-server,https-server --create-disk=auto-delete=yes,boot=yes,device-name=hardik-instance-template,image=projects/debian-cloud/global/images/debian-11-bullseye-v20220519,mode=rw,size=10,type=pd-balanced --no-shielded-secure-boot --shielded-vtpm --shielded-integrity-monitoring --reservation-affinity=any

health check : gcloud beta compute health-checks create tcp hardik-health --project=playground-s-11-99902a3b --port=5000 --proxy-header=NONE --no-enable-logging --check-interval=10 --timeout=10 --unhealthy-threshold=3 --healthy-threshold=2

MIG :
gcloud beta compute instance-groups managed create instance-group-1 --project=playground-s-11-99902a3b --base-instance-name=instance-group-1 --size=2 --template=hardik-instance-template --zones=us-central1-c,us-central1-f,us-central1-b --target-distribution-shape=EVEN --health-check=hardik-health --initial-delay=300 && gcloud beta compute instance-groups managed set-autoscaling instance-group-1 --project=playground-s-11-99902a3b --region=us-central1 --cool-down-period=60 --max-num-replicas=3 --min-num-replicas=2 --mode=on --target-cpu-utilization=0.6



startup script cmnds :
sudo apt update
sudo apt install python3-pip -y
sudo apt-get -y install git
git clone https://github.com/hardikgandhi03/flask-demo
cd /flask-demo/
touch serviceAccountKey.json
echo '{             
  "type": "service_account",
  "project_id": "trial-fb207",
  "private_key_id": "01da41bff322ce4d6fe0171e3bf31121f0436eb0",
  "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCis7Egce4ZsC5z\nC3gO7D8rICYpQKT87B+s40/+l6R1jAiSWaWMhL3LrvhN7n9ZBAH7sqVHMDtpUAyH\nytTu2FFlA04W5ZQEtf7ewTZVBN2uqYUBgAI6mZ9eOic9vaWAaVzsH2BYF4Z4dK56\nDFBma5MOGz+4BO8ksYJ1Gz7Hff5GR7ex+ayqQl5GJnBC/cVEtbuUVB+4Ss8D7042\nNfZcpu4hKX6IKl3ydnJANe7ouikC+/Wqota7w1eW9VLnZt8jiuLJ53v73vZSx1X/\nbj2SxMSJ+nvYMrDronbcVd+JrOzFvZ/8y9eU+0lhes82woXaQXBDq5vw5NgqG6jm\noYxh+0cBAgMBAAECggEAIaqfF0Cb7TLYmbOg1y2pcIoJe3XF7hQKBeNPdTX5sN0W\nFPp52BbLky8UcEPOlCPRKTzxGEbxtDv9K8gbwYR/azCA4xoEQ+lI4N0IGhWUrYSk\nYggT7f5FzOCpqAvrCCRFNxLTA8dyatByHg0YQek2l6+pwrE6rtQQU50co3j9uZre\n0pYMU0gCHSOZGUMqzd8b8iQ6alKFBS6tA4yZk0VeN5rxijjJ9xGbiS15YX+ftjTn\n3SI2HsbwuiYE7/0Pj/nUmDIFi1v53o/U6ipNaa4g+1iDxUXgrY3gTBmguJTI5C1Q\n/flrd3w+Y77JpdqVhbdyh2Ak4oGLEg4IkL/EugneMQKBgQDZ4YO6m5SkKMDeC4GY\nQU3G3wbM+PxUREF5Drszu+qL4K4LubBI0nY2KkOnZIgVbz42iAstNXun8mPCKJVP\nLeOWiWg0yrMGLQNQRxzxpN9PUeOxzI6pt4GV9a05FjsNutJmnFwxmzNzNo/SHWQ2\nH7TTKvogWE0gU3UlIrOQ73VUdQKBgQC/Ks/JN/7bEowr5wYAGkTAo43C1RyKpjzY\nmsXQxQnnt6w5wVAdK2k9X5tbJlEgUp7XsbixfbowQTONkuPrfyanmbhjUAbbp7TR\nG6XR4rEPU8+ZcIK/bC9EH1mOYMPnmE8CHcV1N2vxRrPW72r4o+81AiQCOCN6OrgP\nKYEHvYgm3QKBgCT1gS/tZkh2dUj1MLWQFk5u1Kt+bOcqcOTFH/JFpSK3KS7p/8JK\nmSzU/IbvobnpFeeQKj0v/lrd3hg4ZCN7SEjn5BpYbAfXKOG8PmerLQo6fOJTLbwS\nWdQDSbAOWlQY5cnsKiNsDU006y6cN7yKolTTzHwiHmsmXQ/AlC84v3FlAoGBALm2\naoPNbT3/58KivbaNzmriuM4k4IRleMjomvH06Wl9isfU3/JmgOeJoNBNChT/jqZ2\nVbnALYfBX8bSg679KF07veBlFzR+2O8oD9A1jNMaFZy3q50xCT4BwqvJn6e21FJ2\n/6OfArMzf3R3xJDmGXWCrd6mEPkmYDcCmAIgA0vVAoGAKnV1ygGaykqa8n5212NX\nLkwRCxbyJlfJyHwLNiL3nZ4hg2rb0M2RqAvasFEYODggC0PORZageWkqts3L44Ym\n9v1/ufZpuQyZEGFnBIBS7pLuKSMpcNrjKTm/U4+WHpK1piLZ+tVoot+PvTOKV1TU\nONpxRLzeXjmTOWXvws2vqFQ=\n-----END PRIVATE KEY-----\n",
  "client_email": "firebase-adminsdk-vbler@trial-fb207.iam.gserviceaccount.com",
  "client_id": "100541879703177688473",
  "auth_uri": "https://accounts.google.com/o/oauth2/auth",
  "token_uri": "https://oauth2.googleapis.com/token",
  "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
  "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-vbler%40trial-fb207.iam.gserviceaccount.com"
}' > serviceAccountKey.json
pip install flask
sudo pip install firebase-admin
python3 main.py



Front end startup script :
sudo apt-get -y install git
git clone https://github.com/hardikgandhi03/flask-demo
sudo apt update && sudo apt -y install apache2
cd /var/www/
sudo chmod 777 html/
cd /home/cloud_user_p_16c59cf2/
mv * /var/www/html/

